(function(window,undefined){var _G=window.G;var _isLogging=true;var G=G||{instanceId:null,appKey:null,endPoint:null,persistenceToken:null,appSecret:null,init:function(appKey,endPoint,callback){G.appKey=appKey;G.endPoint=endPoint;G.api("/misc/random_hash.json",function(json){G.instanceId=json.hash_digest;callback()})},provide:function(target,source,overwrite){return this.copy(typeof target=="string"?this.create(target):target,source,overwrite)},create:function(name,value){var node=G,nameParts=name?
name.split("."):[],len=nameParts.length;for(var i=0;i<len;i++){var part=nameParts[i];var nso=node[part];if(!nso){nso=value&&i+1==len?value:{};node[part]=nso}node=nso}return node},copy:function(target,source,overwrite,transform){for(var key in source)if(overwrite||typeof target[key]==="undefined")target[key]=transform?transform(source[key]):source[key];return target},deepCopy:function(target,source,overwrite,transform){G.copy(target,source,overwrite,transform);for(var key in source)if(typeof source[key]===
"object"&&source[key]!=null){target[key]=source[key]instanceof Array?[]:{};G.deepCopy(target[key],source[key],overwrite,transform)}return target},noConflict:function(altName){if(altName=="G")window.G=G;else if(altName){window[altName]=G;window.G=_G}globalName=altName;return G}};window.G=G;var globalName="G";G.provide("Tracker",{iframe:null,endpoint:"https://analytics.groupit.com",accountToken:null,init:function(){G.Tracker.iframe=G.ApiClient.createHiddenIframe()},trackEvent:function(category,action,
optLabel,optValue){if(!category||!action){G.log("trackEvent requires category and action arguments");return}var pre={trackevent:category,action:action};if(optLabel)pre["optlabel"]=optLabel;if(optValue)pre["optvalue"]=optValue;var qs=G.QS.encode(pre);G.Tracker.iframe.src=G.Tracker.endpoint+"?"+qs},trackPageview:function(path){if(!path){G.log("trackPageview requires a path argument");return}var qs=G.QS.encode({trackpageview:path});G.Tracker.iframe.src=G.Tracker.endpoint+"?"+qs},doubleTrack:function(obj){if(!obj&&
!obj.trackPageview&&!obj.trackEvent){G.log("doubleTrack requires a complete object argument");return}te=obj.trackEvent;tpv=obj.trackPageview;var pre={trackpageview:tpv.path,trackevent:te.category,action:te.action};if(te.optLabel)pre["optlabel"]=te.optLabel;if(te.optValue)pre["optvalue"]=te.optValue;var qs=G.QS.encode(pre);G.Tracker.iframe.src=G.Tracker.endpoint+"?"+qs}});G.provide("args",{parse:function(_arguments,mapObject){var parsedArgs={},next=_arguments.shift();while(next){var type=typeof next,
name=mapObject[type];if(!name||parsedArgs[name])throw"Parsing came across a type: "+type+" that it wasn't expecting";parsedArgs[name]=next;next=_arguments.shift()}return parsedArgs}});G.provide("Array",{indexOf:function(array,item){if(array.indexOf)return array.indexOf(item);var length=array.length;if(length)for(var index=0;index<length;index++)if(array[index]===item)return index;return-1},map:function(arr,transform){var ret=[];for(var i=0;i<arr.length;i++)ret.push(transform(arr[i]));return ret}});
G.provide("",{newBindableObject:function(obj,shallow,debug){var bindable=new G.BindableObject.Base(debug);bindable.extend(obj,shallow);return bindable}});G.provide("BindableObject",{Base:function(debug){var self=this;self._listeners={};self._data={};this.extend=function(obj,deep){if(!obj)return;if(typeof obj!=="object")throw"Must pass object/array to extend";if(obj instanceof Array)G.Array.map(obj,function(val){self.generateGetterSetter(val);self.generateCallback(val)});else for(var key in obj){self.generateGetterSetter(key);
self.generateCallback(key);self[self.nameConversion(key)](obj[key],deep)}};this.merge=function(bindableObject){for(var key in bindableObject._listeners){var listenerArray=bindableObject._listeners[key];for(var i in listenerArray){self._listeners[key]=self._listeners[key]||[];self._listeners[key].push(listenerArray[i])}}G.copy(self._data,bindableObject._data,true);return self};this.flush=function(){for(var key in self._data)fireOnKey(key)};this.data=function(){return G.deepCopy({},self._data,true)};
this.dump=function(){G.log(self._data);G.log(self._listeners)};this.nameConversion=function(name){return name};this.callbackName=function(name){name=self.nameConversion(name);return"on"+name.charAt(0).toUpperCase()+name.slice(1)};this.generateCallback=function(name){var keyName=self.callbackName(name);self[keyName]=function(fn,remove){self._listeners[name]=self._listeners[name]||[];if(remove)for(var i in self._listeners[name]){var fn2=self._listeners[name][i];if(fn2.toString()==fn.toString()){self._listeners[name].splice(i,
1);G.log("removing")}}else{self[keyName](fn,true);self._listeners[name].push(fn)}}};this.generateGetterSetter=function(name){self[this.nameConversion(name)]=function(){var args=Array.prototype.slice.call(arguments);if(args.length==0)return self._data[name];else{var value=args.shift(),deep=args.shift();return set(name,value,deep)}}};function fireOnKey(key){self._listeners[key]=self._listeners[key]||[];for(var i in self._listeners[key])if(self._listeners[key][i]){if(debug)G.log("--Event Listener on key: "+
key+" Fired--");self._listeners[key][i](self._data[key])}}function set(key,value,deep){self._listeners[key]=self._listeners[key]||[];if(deep&&typeof value==="object"&&value!=null){var empty=value instanceof Array?[]:{};self._data[key]=G.deepCopy(empty,value,true)}else self._data[key]=value;fireOnKey(key);return self._data[key]}}});G.provide("browser",{ieVersion:function(){var rv=-1;if(navigator.appName=="Microsoft Internet Explorer"){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");
if(re.exec(ua)!=null)rv=parseFloat(RegExp.$1)}return rv}});G.provide("cookie",{getExpDate:function(days,hours,minutes){var expDate=new Date;if(typeof days=="number"&&typeof hours=="number"&&typeof hours=="number"){expDate.setDate(expDate.getDate()+parseInt(days));expDate.setHours(expDate.getHours()+parseInt(hours));expDate.setMinutes(expDate.getMinutes()+parseInt(minutes));return expDate.toGMTString()}else return""},getCookie:function(name){var arg=name+"=";var alen=arg.length;var clen=document.cookie.length;
var i=0;while(i<clen){var j=i+alen;if(document.cookie.substring(i,j)==arg)return getCookieVal(j);i=document.cookie.indexOf(" ",i)+1;if(i==0)break}return"";function getCookieVal(offset){var endstr=document.cookie.indexOf(";",offset);if(endstr==-1)endstr=document.cookie.length;return decodeURIComponent(document.cookie.substring(offset,endstr))}},setCookie:function(name,value,expires,path,domain,secure){document.cookie=name+"="+encodeURIComponent(value)+(expires?"; expires="+expires:"")+(path?"; path="+
path:"")+(domain?"; domain="+domain:"")+(secure?"; secure":"")},deleteCookie:function(name,path,domain){if(G.cookie.getCookie(name))document.cookie=name+"="+(path?"; path="+path:"")+(domain?"; domain="+domain:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT"}});G.provide("Date",{isIso8601Date:function(string){if(!string)return false;return string.match(/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/)},
iso8601DateString:function(date){function pad(n){return n<10?"0"+n:n}return date.getUTCFullYear()+"-"+pad(date.getUTCMonth()+1)+"-"+pad(date.getUTCDate())+"T"+pad(date.getUTCHours())+":"+pad(date.getUTCMinutes())+":"+pad(date.getUTCSeconds())+"Z"},iso8601DateParse:function(dateString){dateString=dateString.toLowerCase();var tSep="t",tIndex=dateString.indexOf(tSep),spaceIndex=dateString.indexOf(" "),sep=null;if(tIndex!=-1)sep=tSep;if(spaceIndex!=-1)sep=" ";var justDate=!sep;if(justDate)return new Date(parseDate(dateString));
else{var parts=dateString.split(sep);return new Date(parseDate(parts[0])+parseTime(parts[1]))}function parseDate(dateString){try{var parts=dateString.split("-");if(parts.length==3)return Date.UTC(parts[0],parseFloat(parts[1])-1,parts[2]);else if(dateString.length==8){var year=dateString.substr(0,4),month=dateString.substr(4,2),day=dateString.substr(6);return Date.UTC(year,month,day)}else{G.log("Date string was invalid. "+dateString);return 0}}catch(err){return 0}}function parseTime(timeString){try{var timeRe=
/^(\d{2}).(\d{2}).(\d{2})/;if(!timeRe.test(timeString)){G.log("Time String was invalid "+timeString);return 0}var hour=timeString.substr(0,2),minute=timeString.substr(3,2),second=timeString.substr(6,2);var diff=Date.UTC(1970,1,1,hour,minute,second)-Date.UTC(1970,1,1);timeString=timeString.replace(timeRe,"");var offset=/^([+,-])(\d{2})/;if(offset.test(timeString)){var opp=timeString.substr(0,1),offHour=timeString.substr(1,2),adjustment=parseFloat(offHour)*60*60*1E3;diff=opp=="+"?diff-adjustment:diff+
adjustment}return diff}catch(err){return 0}}}});G.provide("",{addEvent:function(object,eventType,eventHandler){G.eventManager.addEvent.call(G.eventManager,object,eventType,eventHandler)},removeEvent:function(object,eventType,eventHandler){G.eventManager.removeEvent.call(G.eventManager,object,eventType,eventHandler)}});G.provide("eventManager",{addEvent:function(obj,type,fn){if(obj.attachEvent){obj["e"+type+fn]=fn;obj[type+fn]=function(){obj["e"+type+fn](window.event)};obj.attachEvent("on"+type,obj[type+
fn])}else obj.addEventListener(type,fn,false)},removeEvent:function(obj,type,fn){if(obj.detachEvent){if(!obj[type+fn])return;obj.detachEvent("on"+type,obj[type+fn]);obj[type+fn]=null}else obj.removeEventListener(type,fn,false)}});G.provide("",{initialize:function(appKey,endPoint,callback){G.DataObject.init();G.router.init();G.init(appKey,endPoint,function(){callback()})}});G.provide("",{log:function(message){if(window.console)window.console.log(message)}});G.provide("QS",{encode:function(params,seperator,
encode){seperator=seperator===undefined?"&":seperator;encode=encode===false?function(s){return s}:encodeURIComponent;var kvPairs=[];for(var key in params){var val=params[key];if(val!==null&&typeof val!="undefined")kvPairs.push(encode(key)+"="+encode(val))}kvPairs.sort();return kvPairs.join(seperator)},nestedEncode:function(params,seperator,encode){seperator=seperator===undefined?"&":seperator;encode=encode===false?function(s){return s}:encodeURIComponent;function deepCall(prefix,params,array){for(var key in params){var val=
params[key],type=typeof val;if(val!==null&&type!=="undefined"&&type==="object"&&!(val instanceof Array))deepCall(prefix+"["+key+"]",val,array);else array.push(encode(prefix+"["+key+"]")+"="+encode(val))}}var kvPairs=[];for(var key in params){var val=params[key],type=typeof val;if(val!==null&&type!=="undefined"&&type==="object"&&!(val instanceof Array)){deepCall(key,val,kvPairs);continue}kvPairs.push(encode(key)+"="+encode(val))}kvPairs.sort();return kvPairs.join(seperator)}});G.provide("String",{toCamelCase:function(string){var newString=
String(string);var re=/(_)([a-z].*?)/gi,matchResult=re.exec(newString);while(matchResult){if(matchResult[2])newString=newString.replace(matchResult[0],matchResult[2].toUpperCase());matchResult=re.exec()}return newString},toUnderscore:function(string){if(!string)return string;return string.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()})},reverse:function(s){return s.split("").reverse().join("")}});G.provide("",{api:function(){G.ApiClient.rest.apply(G.ApiClient,arguments)},postViaForm:function(path,
method,params,fullPath){G.ApiClient.remotePost(path,method,params,fullPath)}});G.provide("ApiClient",{REST_METHODS:["get","post","delete","put"],rest:function(){var args=Array.prototype.slice.call(arguments),path=args.shift(),next=args.shift(),method,params,cb,doCors;while(next){var type=typeof next;if(type==="string"&&!method)method=next.toLowerCase();else if(type==="function"&&!cb)cb=next;else if(type==="object"&&!params)params=next;else{G.log("Invalid argument passed to G.api(): "+next);return}next=
args.shift()}method=method||"get";params=params||{};if(path[0]==="/")path=path.substr(1);if(G.Array.indexOf(G.ApiClient.REST_METHODS,method)<0){G.log("failed on rest methods");return}G.ApiClient.corsRequest(path,method,params,cb)},corsRequest:function(path,method,params,cb){method=method.toLowerCase();if(method=="put"){method="post";params["_method"]="put"}else if(method=="delete"){method="get";params["_method"]="delete"}var url=G.endPoint+path;var queryString=G.QS.encode(params);if(method=="get")url+=
"?"+queryString;var xhr=new XMLHttpRequest;if("withCredentials"in xhr)xhr.open(method,url,true);else if(typeof XDomainRequest!="undefined"){xhr=new XDomainRequest;xhr.open(method,url)}else throw"corsRequest: cross site xhr not available";if(cb){xhr.onload=function(){if(!xhr.contentType)if(xhr.getResponseHeader)xhr.contentType=xhr.getResponseHeader("Content-Type");var contentType=typeof xhr.contentType=="string"?xhr.contentType.toLowerCase():"";var response=xhr.responseText;if(contentType.indexOf("application/json")!=
-1&&response.replace(/\s*/,""))eval("response = "+"("+response+")");if(xhr.status){xhr.success=!!xhr.status.toString().match(/^2../);xhr.clientError=!!xhr.status.toString().match(/^4../);xhr.serverError=!!xhr.status.toString().match(/^5../)}else{xhr.success=!!xhr.responseText;xhr.clientError=xhr.serverError=!xhr.responseText}cb(response,xhr)};xhr.onerror=xhr.onload}if(method=="get")xhr.send();else{if(xhr.setRequestHeader)xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.send(queryString)}},
nonCorsDispatch:function(path,method,params,cb){if(method==="post")var form=G.ApiClient.createForm(path,method,params)},remotePost:function(path,method,params,fullPath){var iframe=G.ApiClient.createHiddenIframe(function(iframe,doc){var form=G.ApiClient.createForm(path,method,params,fullPath,doc);if(form){doc.body.appendChild(form);form.submit()}});setTimeout(function(){if(iframe.parentNode)iframe.parentNode.removeChild(iframe)},3E4)},createHiddenIframe:function(callback){var iframe=document.createElement("iframe");
iframe.style.position="absolute";iframe.style.top="-10000px";iframe.style.height="0px";iframe.style.width="0px";document.body.appendChild(iframe);var iframeDocument=iframe.contentDocument||iframe.contentWindow.document;iframeDocument.open();iframeDocument.close();if(callback)callback(iframe,iframeDocument);return iframe},createForm:function(path,method,params,fullPath,doc){doc=doc||document;var form=doc.createElement("form");form.action=fullPath?path:G.endPoint+path;form.enctype="multipart/form-data";
form.method=method;for(var key in params){var input=doc.createElement("input");input.type="hidden";input.name=key;input.value=params[key];form.appendChild(input)}return form}});G.provide("",{newFnChain:function(){return new G.FnChain.Base}});G.provide("FnChain",{Base:function(){var chain=[];this.push=function(){var args=Array.prototype.slice.call(arguments),fn=args.shift(),next=args.shift(),params=null,callback=null;while(next){var type=typeof next;if(type==="function"&&!callback)callback=next;else if(next instanceof
Array&&!params)params=next;else throw"Invalid argument passed to FnChain.push(): "+next;next=args.shift()}var link={fn:fn,params:params,callback:callback};chain.push(link);return this};this.pushNc=function(fn,params){function correctedFn(callback){if(params)fn.apply(this,params);else fn();callback()}this.push(correctedFn);return this};this.fire=function(){if(chain.length<=0)return;var link=chain.shift(),callee=arguments.callee;if(link.params){var tempParams=[];G.copy(tempParams,link.params);tempParams.push(modifiedCallback);
link.fn.apply(this,tempParams)}else link.fn(modifiedCallback);function modifiedCallback(){if(link.callback)link.callback.apply(this,arguments);callee()}};this.clear=function(){chain=[]}}});G.provide("",{newDataObject:function(objectPath,objectName,constructorFn,keys){var bo=G.newBindableObject();G.DataObject.Base.prototype=bo;bo.nameConversion=function(name){return G.String.toCamelCase(name)};var base=new G.DataObject.Base(objectPath,objectName,constructorFn);base.extend(keys);return base}});G.provide("DataObject",
{apiObjects:{payment_response:{path:"/payment_responses",keys:["user_id","groupit_id","ip_address","success","response","is_public","id","created_at","updated_at"]},participant:{path:"/participants",keys:["groupit_id","contacted","is_public","user_id","id","created_at","updated_at","invited","organizer","contributor"]},invitee:{path:"/invitees",keys:[]},note:{path:"/notes",keys:["note","metadata_id","metadata_type","is_public","user_id","id","created_at","updated_at","name"]},feed_post:{path:"/feed_posts",
keys:["message","groupit_id","is_public","user_id","id","created_at","updated_at"]},authentication:{path:"/authentications",keys:["user_id","provider","uid","is_public","id","created_at","updated_at"]},app:{path:"/apps",keys:["name","user_id","is_public","id","created_at","updated_at","key"]},address:{path:"/addresses",keys:["fullname","line1","line2","city","state","zip","country","phone_number","user_id","is_public","id","created_at","updated_at"]}},defaultRequestType:".json",commonConstructor:function(namespace,
constructorFn,json){var ns=namespace;var dataObj=G.newDataObject(ns.path,ns.objectName,constructorFn,ns.keys);ns.Base.prototype=dataObj;var base=new ns.Base;if(json)base.extend(json);return base},commonIndex:function(config,namespace,constructorFn,params,callback){config=config||{};params=params||{};var path=namespace.path+G.DataObject.defaultRequestType,name=namespace.objectName;for(var key in config.params)params[G.String.toUnderscore(key)]=config.params[key];params=G.dogfort.injectRailsParams(params);
G.api(path,"get",params,function(json,xhr){if(xhr.success){var models=[];for(var i in json)models.push(constructorFn(json[i][name]));callback(models);if(config.success)config.success(models,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})},init:function(){for(var key in G.DataObject.apiObjects)(function(){var name=key,path=G.DataObject.apiObjects[name].path,keys=G.DataObject.apiObjects[name].keys;var camelCased=G.String.toCamelCase(name),capName=camelCased.charAt(0).toUpperCase()+
camelCased.slice(1),constructorName="new"+capName;G[constructorName]=function(json){var base=G.newDataObject(path,name,G[constructorName],keys);if(json)base.extend(json);return base};G[capName]=G[capName]||{};G[capName].index=function(config){config=config||{};var params={};for(var key in config.params)params[G.String.toUnderscore(key)]=config.params[key];params=G.dogfort.injectRailsParams(params);G.api(path+".json","get",params,function(json,xhr){if(xhr.success){var models=[];for(var i in json)models.push(G[constructorName](json[i][name]));
if(config.success)config.success(models,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})}})()},Base:function(objectPath,objectName,constructorFn){var self=this;self.requestType=G.DataObject.defaultRequestType;self.objectPath=objectPath;self.objectName=objectName;self.constructorFn=constructorFn;self.create=function(config){config=config||{};var path=objectPath+self.requestType;var params=self.data();params=self.railify(params);if(config.params)G.copy(params,
config.params,true);params=G.dogfort.injectRailsParams(params);G.api(path,"post",params,function(json,xhr){if(xhr.success){self.extend(self.stripNamespace(json));if(config.success)config.success(self,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})};self.read=function(config){config=config||{};var params=self.data(),path=objectPath+"/"+(params.id||"undefined")+self.requestType;params=self.railify(params);params=G.dogfort.injectRailsParams(params);G.api(path,
"get",params,function(json,xhr){if(xhr.success){self.extend(self.stripNamespace(json));if(config.success)config.success(self,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})};self.update=function(config){config=config||{};var params=self.data(),path=objectPath+"/"+(params.id||"undefined")+self.requestType;params=self.railify(params);params=G.dogfort.injectRailsParams(params);G.api(path,"put",params,function(json,xhr){if(xhr.success){if(config.success)config.success(json,
xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})};self.destroy=function(config){config=config||{};var params=self.data(),path=objectPath+"/"+(params.id||"undefined")+self.requestType;params=self.railify(params);params=G.dogfort.injectRailsParams(params);G.api(path,"delete",params,function(json,xhr){if(xhr.success){if(config.success)config.success(json,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})};self.railify=
function(params){var rails_params={};for(var key in params){if(key=="id")continue;if(key=="poll_ticket"){rails_params[key]=params[key];continue}rails_params[objectName+"["+key+"]"]=params[key]}return rails_params};self.stripNamespace=function(json){return json[self.objectName]}}});G.provide("dogfort",{injectRailsParams:function(params){params=params||{};if(!params["user[persistence_token]"]&&G.persistenceToken)params["user[persistence_token]"]=G.persistenceToken;params["app_key"]=G.appKey;if(G.appSecret)params["app_secret"]=
G.appSecret;if(params["app_secret"]&&!G.appSecret)throw"App secret not set using G.RestObject.appSecret";return params},injectIncludes:function(params,includes){},injectPollTicket:function(params,pollTicket){params.poll_ticket=pollTicket;return params}});G.provide("",{newContribution:function(json){var namespace=G.models.contribution;return G.DataObject.commonConstructor(namespace,G.newContribution,json)}});G.provide("models.contribution",{objectName:"contribution",path:"/contributions",keys:["groupit_id",
"address_id","amount","user_id","transaction_id","surcharge","payment_response_id","app_key","is_public","id","created_at","updated_at"],Base:function(){var self=this;this.create=function(config){config=config||{};var params=config.params,newParams=G.dogfort.injectRailsParams({}),pollTicket=G.polling.uniqueTicket();G.copy(params,self.data());G.api("/contributions/new.json","get",newParams,function(json){var brainTreeUrl=json.url,tr_data=json.tr_data;params=G.dogfort.injectRailsParams(params);var braintreeFormParams=
self.braintreeParams(tr_data,pollTicket,params);G.postViaForm(brainTreeUrl,"post",braintreeFormParams,true);var pollingParams=self.injectPollTicket({},pollTicket);pollForResponse(pollingParams,0,config)})};function pollForResponse(requestParams,attempts,config){self.pollOnce(requestParams,function(json,xhr){var loaded=xhr.status=="200"||typeof json==="object",waiting=xhr.status=="204"||typeof json==="string";if(attempts>20){var hash={error:{message:"After "+attempts+" attempts no contribution was found"}};
if(config.error)config.error(hash,xhr);if(config.complete)config.complete(hash,xhr)}else if(waiting)continuePolling(1500);else if(loaded){if(xhr.success){self.extend(json);if(config.success)config.success(self,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)}else{if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr);G.log("Polling returned a unexpected status:"+xhr.status)}function continuePolling(timeout){setTimeout(function(){pollForResponse(requestParams,
attempts+1,config)},timeout)}})}this.pollOnce=function(params,callback){var path=self.objectPath+"/poll"+self.requestType;params=G.dogfort.injectRailsParams(params);G.api(path,"get",params,function(json,xhr){if(json.status)xhr.success=json.status==200;if(xhr.success)json=self.stripNamespace(json);if(callback)callback(json,xhr)})};this.injectPollTicket=function(params,pollTicket){params.poll_ticket=pollTicket;return params};this.braintreeParams=function(tr_data,pollTicket,params){var map={};function mapIfDefined(key,
value){if(!value&&value!=0)return;map[key]=value}mapIfDefined("tr_data",tr_data);mapIfDefined("transaction[custom_fields][poll_ticket]",pollTicket);mapIfDefined("transaction[custom_fields][groupit_id]",params.groupit_id);mapIfDefined("transaction[custom_fields][user_id]",params.user_id);mapIfDefined("transaction[amount]",params.amount);mapIfDefined("transaction[custom_fields][app_key]",G.appKey);mapIfDefined("transaction[custom_fields][session_token]",G.persistenceToken);mapIfDefined("transaction[customer][first_name]",
params.customer.firstName);mapIfDefined("transaction[customer][last_name]",params.customer.lastName);mapIfDefined("transaction[customer][email]",params.customer.email);mapIfDefined("transaction[credit_card][cardholder_name]",params.cc.cardholderName);mapIfDefined("transaction[credit_card][number]",params.cc.number);mapIfDefined("transaction[credit_card][cvv]",params.cc.cvv);mapIfDefined("transaction[credit_card][expiration_month]",params.cc.month);mapIfDefined("transaction[credit_card][expiration_year]",
params.cc.year);mapIfDefined("transaction[billing][first_name]",params.billing.firstName);mapIfDefined("transaction[billing][last_name]",params.billing.lastName);mapIfDefined("transaction[billing][street_address]",params.billing.address1);mapIfDefined("transaction[billing][extended_address]",params.billing.address2);mapIfDefined("transaction[billing][locality]",params.billing.locality);mapIfDefined("transaction[billing][region]",params.billing.region);mapIfDefined("transaction[billing][postal_code]",
params.billing.postalCode);mapIfDefined("transaction[billing][country_code_alpha2]",params.billing.countryCode);mapIfDefined("transaction[customer][phone]",params.billing.phone);return map}}});G.provide("",{newEmail:function(json){var namespace=G.models.email;return G.DataObject.commonConstructor(namespace,G.newEmail,json)}});G.provide("models.email",{objectName:"email",path:"/emails",keys:["address","primary","user_id","retail_contact","id","created_at","updated_at","hash_digest"],Base:function(){var self=
this;self.resendVerify=function(config){config=config||{};var params=self.data(),path=G.models.email.path+"/"+(params.id||"undefined")+"/resend_verify";params=G.dogfort.injectRailsParams(params);G.api(path,"get",params,function(json,xhr){if(xhr.success){if(config.success)config.success(self,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})}}});G.provide("",{newGroupit:function(json){var namespace=G.models.groupit;return G.DataObject.commonConstructor(namespace,
G.newContribution,json)}});G.provide("models.groupit",{objectName:"groupit",path:"/groupits",keys:["id","product_image","product_uri","product","price","message","surprise","quantity","user_id","recipient","options","active","lead_uri","support_uri","purchase_date","groupit_type","created_at","updated_at","hash_digest","organizer","amount_raised","end_date","redeem_date"],index:function(config){var params={include:["user","participants","contributions"]};G.DataObject.commonIndex(config,G.models.groupit,
G.newGroupit,params,wrapIncludes);function wrapIncludes(models){for(var i in models){var j;var model=models[i];if(model.user)model.user(G.newUser(model.user()));if(model.participants){var parts=[];for(j in model.participants()){var participant=model.participants()[j];participant.user=G.newUser(participant.user);parts.push(G.newParticipant(participant))}model.participants(parts)}if(model.contributions){var contrs=[];for(j in model.contributions()){var contribution=model.contributions()[j];var user=
commonUser(contribution.user_id,model.participants());contribution.user=user;contrs.push(G.newContribution(model.contributions()[j]))}model.contributions(contrs)}}}function commonUser(userId,participants){for(var i in participants){var p=participants[i];if(p.userId()==userId)return p.user()}return null}},Base:function(){}});G.provide("",{newUser:function(json){var namespace=G.models.user;return G.DataObject.commonConstructor(namespace,G.newContribution,json)}});G.provide("models.user",{objectName:"user",
path:"/users",keys:["name","login","organized_before","is_public","id","created_at","updated_at","name","password","persistence_token","single_access_token"],Base:function(){var self=this;var cookieName="__groupit__persistenceToken";self.extend(["authd"]);self.signin=function(config){config=config||{};var path=self.objectPath+"/login"+self.requestType;var params=self.data();params=self.railify(params,self.objectName);params=G.dogfort.injectRailsParams(params);G.api(path,"post",params,function(json,
xhr){if(xhr.success){json=self.stripNamespace(json,xhr);G.persistenceToken=json.persistence_token;G.cookie.setCookie(cookieName,json.persistence_token,G.cookie.getExpDate(7,0,0),"/");self.extend(json);self.authd(true);if(config.success)config.success(self,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})};self.signout=function(config){config=config||{};var params={},self=this;G.persistenceToken=null;G.cookie.deleteCookie(cookieName,"/");self.authd(false);
self.name("");self.login("");self.persistenceToken("");var path=self.objectPath+"/logout"+self.requestType;params=G.dogfort.injectRailsParams(params);G.api(path,"post",params,function(json,xhr){if(xhr.success){if(config.success)config.success(self,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})};self.resetPasswordEmail=function(config){config=config||{};var self=this,path=self.objectPath+"/reset_password_email"+self.requestType,params=self.data();params=
self.railify(params,self.objectName);params=G.dogfort.injectRailsParams(params);G.api(path,"post",params,function(json,xhr){if(xhr.success){if(config.success)config.success(self,xhr)}else if(config.error)config.error(json,xhr);if(config.complete)config.complete(json,xhr)})};self.currentPersistenceToken=function(){var cookieToken=G.cookie.getCookie(cookieName);return G.persistenceToken||cookieToken}}});G.provide("polling",{uniqueTicket:function(){var date=new Date;return G.appKey+""+G.instanceId+""+
date.getTime()}});G.provide("RestObject",{persistenceToken:null,appSecret:null,Base:function(rootPath,objectName){var self=this;this.requestType=".json";this.rootPath=rootPath;this.objectName=objectName;this.index=function(params,callback){var path=rootPath+self.requestType;params=self.railify(params);params=G.RestObject.injectRailsParams(params);G.api(path,"get",params,callback)};this.create=function(params,callback){var path=rootPath+self.requestType;params=self.railify(params);params=G.RestObject.injectRailsParams(params);
G.api(path,"post",params,function(json,xhr){if(callback)callback(self.stripNamespace(json,xhr),xhr)})};this.read=function(params,callback){var path=rootPath+"/"+(params.id||"undefined")+self.requestType;params=self.railify(params);params=G.RestObject.injectRailsParams(params);G.api(path,"get",params,function(json,xhr){if(callback)callback(self.stripNamespace(json,xhr),xhr)})};this.update=function(params,callback){var path=rootPath+"/"+(params.id||"undefined")+self.requestType;params=self.railify(params);
params=G.RestObject.injectRailsParams(params);G.api(path,"put",params,callback)};this.destroy=function(params,callback){var path=rootPath+"/"+(params.id||"undefined")+self.requestType;params=self.railify(params);params=G.RestObject.injectRailsParams(params);G.api(path,"delete",params,callback)};this.pollOnce=function(params,callback){var path=rootPath+"/poll"+self.requestType;params=self.railify(params);params=G.RestObject.injectRailsParams(params);G.api(path,"get",params,function(json,xhr){if(callback)callback(self.stripNamespace(json,
xhr),xhr)})};this.railify=function(params){var rails_params={};for(var key in params){if(key=="id")continue;if(key=="poll_ticket"){rails_params[key]=params[key];continue}rails_params[objectName+"["+key+"]"]=params[key]}return rails_params};this.stripNamespace=function(json,xhr){return xhr.success?json[objectName]:json}},injectRailsParams:function(params){params=params||{};if(!params["user[persistence_token]"]&&G.RestObject.persistenceToken)params["user[persistence_token]"]=G.RestObject.persistenceToken;
params["app_key"]=G.appKey;if(G.RestObject.appSecret)params["app_secret"]=G.RestObject.appSecret;if(params["app_secret"]&&!G.RestObject.appSecret)throw"App secret not set using G.RestObject.appSecret";return params},injectPollTicket:function(params,pollTicket){params.poll_ticket=pollTicket;return params}});G.provide("",{user:function(){var base=new G.RestObject.Base("/users","user");function Override(){var self=this;var cookieName="__groupit__persistenceToken";this.login=function(params,callback){var path=
self.rootPath+"/login"+self.requestType;params=self.railify(params,self.objectName);params=G.RestObject.injectRailsParams(params);G.api(path,"post",params,function(json,xhr){json=self.stripNamespace(json,xhr);if(xhr.success){G.RestObject.persistenceToken=json.persistence_token;G.cookie.setCookie(cookieName,json.persistence_token,G.cookie.getExpDate(7,0,0),"/")}if(callback)callback(json,xhr)})};this.logout=function(callback){var params={},self=this;G.RestObject.persistenceToken=null;G.cookie.deleteCookie(cookieName,
"/");var path=self.rootPath+"/logout"+self.requestType;params=self.railify(params,self.objectName);params=G.RestObject.injectRailsParams(params);G.api(path,"post",params,function(json,xhr){if(callback)callback(json,xhr)})};this.currentPersistenceToken=function(){var cookieToken=G.cookie.getCookie("__groupit__persistenceToken");return G.RestObject.persistenceToken||cookieToken};this.isLoggedIn=function(){return!!G.RestObject.persistenceToken}}Override.prototype=base;return new Override}(),paymentResponse:function(){return new G.RestObject.Base("/payment_responses",
"payment_response")}(),groupit:function(){return new G.RestObject.Base("/groupits","groupit")}(),participant:function(){return new G.RestObject.Base("/participants","participant")}(),note:function(){return new G.RestObject.Base("/notes","note")}(),feedPost:function(){return new G.RestObject.Base("/feed_posts","feed_post")}(),email:function(){return new G.RestObject.Base("/emails","email")}(),authentication:function(){return new G.RestObject.Base("/authentications","authentication")}(),app:function(){return new G.RestObject.Base("/apps",
"app")}(),address:function(){return new G.RestObject.Base("/addresses","address")}(),invitee:function(){var base=new G.RestObject.Base("/invitees","invitee");function Override(){delete this.update;delete this.read;delete this.index;delete this.destroy}Override.prototype=base;return new Override}()});G.provide("",{route:function(hash,callback){G.router.route.call(G.router,hash,callback)}});G.provide("router",{routes:{},init:function(){G.addEvent(window,"hashchange",G.router.execRoute)},route:function(hashName,
callback){G.router.routes[hashName]=callback},execRoute:function(){var hash=window.location.hash.slice(1),urlParams=hash.split("/"),name=urlParams.shift();var callback=G.router.routes[name];if(!callback)callback=G.router.routes["*"];if(callback)callback(name,urlParams)}});G.provide("",{newTransitionMap:function(){return new G.transition.Base}});G.provide("transition",{Base:function(){var transitions={};this.addTransitions=function(transObj){G.copy(transitions,transObj,true)};this.trigger=function(fromWidget,
toWidget,urlParams){var fn;if(!toWidget)throw"G.transition.trigger: Must go somewhere with toWidget";if(!fromWidget||fromWidget==toWidget){fn=transitions[toWidget.name];if(fn)fn(toWidget,urlParams)}else{fn=transitions[fromWidget.name+"_"+toWidget.name];if(fn)fn(fromWidget,toWidget,urlParams)}}}});G.provide("",{newViewModel:function(defaults){var base=new G.ViewModel.Base;base.set(defaults);return base}});G.provide("ViewModel",{Base:function(){var self=this;var data={};var listeners={};this.get=function(key){return data[key]};
this.set=function(key,value){_set(key,value,true)};this.bind=function(key,context,fn){listeners[key]=listeners[key]||[];var listener={fn:fn,context:context};self.unbind(key,context,fn);listeners[key].push(listener)};this.unbind=function(key,context,fn){listeners[key]=listeners[key]||[];for(var i=0,len=listeners[key].length;i<len;++i){var listener=listeners[key][i];if(listener.fn==fn&&listener.context==context)listeners[key].splice(i,1)}};this.updateOnly=function(key,value){_set(key,value,false)};
this.debug=function(){G.log(data);G.log(listeners)};function _set(key,value,create){listeners[key]=listeners[key]||[];if(typeof key==="object"){var obj=key;for(var k in obj)self.set(k,obj[k],create)}else{if(!create&&key in data||create)data[key]=value;for(var i in listeners[key]){var listener=listeners[key][i];listener.fn.apply(listener.context,[value])}}}}});G.provide("",{require:function(){return G.widget.require.apply(G.widget,arguments)},newWidget:function(){return G.widget.instance.apply(G.widget,
arguments)},register:function(){return G.widget.register.apply(G.widget,arguments)}});G.provide("widget",{constructors:{},html:{},Base:function(name,widgetType){this.name=name;this._html=G.widget.html[widgetType];this.rootNode=initRootNode();function initRootNode(){var div=document.createElement("div");div.innerHTML=G.widget.html[widgetType];return div}this.hashOnAttribute=function(hash,attr){var elems=this.rootNode.getElementsByTagName("*");for(var i in elems){var elem=elems[i],pid;if(!!elem.getAttribute&&
!!(pid=elem.getAttribute(attr)))hash[pid]=elem}};this.preventDefault=function(e){if(!e)return;if(e.preventDefault)e.preventDefault();e.returnValue=false};this.detach=function(){var parent=this.rootNode.parentNode;if(parent)parent.removeChild(this.rootNode)}},instance:function(name,widgetType,instanceObject){if(!G.widget.constructors[widgetType])throw"G.widget.instance called on null constructor. ("+widgetType+")";if(!name)throw"G.widget.instance called without a instance name";var instance;(function(realG){var pids=
{},base;eval("var "+widgetType+" = "+G.widget.constructors[widgetType].toString()+";");base=new realG.widget.Base(name,widgetType);eval(widgetType+".prototype = base");base.hashOnAttribute(pids,"pid");eval("instance = new "+widgetType+"()");if(instanceObject)G.copy(instance,instanceObject,true);function S(selector){if(jQuery)return jQuery(base.rootNode).find(selector)}})(G);return instance},register:function(widgetType,pageConstructor){if(typeof pageConstructor!="function")throw"Fatal: G.widget.register only takes a constructor function as a argument";
G.widget.constructors[widgetType]=pageConstructor},require:function(path,widgetType){G.widget.require.pages=G.Page.require.pages||{};widgetType=widgetType||G.widget.pathToName(path);if(G.widget.require.pages[widgetType])return;G.widget.require.pages[widgetType]=widgetType;if(!G.widget.constructors[widgetType])G.widget.fetch(path,widgetType)},ready:function(widgetTypes,callback){var intervalId,timeWaiting=0,interval=50;intervalId=setInterval(function(){timeWaiting+=interval;if(timeWaiting>1E3){G.log("G.widget.ready waiting over a second for ready state.");
timeWaiting=0}for(var i in widgetTypes){var widgetType=widgetTypes[i];if(!G.widget.constructors[widgetType])return}clearInterval(intervalId);callback()},interval)},fetch:function(){var args=Array.prototype.slice.call(arguments),path=args.shift(),next=args.shift(),widgetType,callback;while(next){var type=typeof next;if(type==="string"&&!widgetType)widgetType=next;else if(type==="function"&&!callback)callback=next;else{G.log("Invalid argument passed to G.widget.fetch(): "+next);return}next=args.shift()}widgetType=
widgetType||G.widget.pathToName(path);G.widget.fetchRequest(path,widgetType,callback)},pathToName:function(path){return path.replace(/\//g,"_")},fetchRequest:function(path,widgetType,callback){var preamble="<script>window.G = top."+globalName+";<\/script>";G.ApiClient.rest("widgets/show","get",{path:path,preamble:preamble,page_name:widgetType},function(html){if(!!callback)callback(G.widget.constructors[widgetType])})}})})(window);
