(function(window,undefined){var _G=window.G;var _isLogging=true;window.A="Primary window";var G=G||{provide:function(target,source,overwrite){return this.copy(typeof target=="string"?this.create(target):target,source,overwrite)},create:function(name,value){var node=G,nameParts=name?name.split("."):[],len=nameParts.length;for(var i=0;i<len;i++){var part=nameParts[i];var nso=node[part];if(!nso){nso=value&&i+1==len?value:{};node[part]=nso}node=nso}return node},copy:function(target,source,overwrite,transform){for(var key in source)if(overwrite||
typeof target[key]==="undefined")target[key]=transform?transform(source[key]):source[key];return target},noConflict:function(altName){if(altName=="G")window.G=G;else if(altName){window[altName]=G;window.G=_G}globalName=altName;return G}};window.G=G;var globalName="G";G.provide("",{api:function(){G.ApiClient.rest.apply(G.ApiClient,arguments)}});G.provide("ApiClient",{REST_METHODS:["get","post","delete","put"],REST_BASE_URL:"http://localhost:3000/",rest:function(){var args=Array.prototype.slice.call(arguments),
path=args.shift(),next=args.shift(),method,params,cb;while(next){var type=typeof next;if(type==="string"&&!method)method=next.toLowerCase();else if(type==="function"&&!cb)cb=next;else if(type==="object"&&!params)params=next;else{G.log("Invalid argument passed to G.api(): "+next);return}next=args.shift()}method=method||"get";params=params||{};if(path[0]==="/")path=path.substr(1);if(G.Array.indexOf(G.ApiClient.REST_METHODS,method)<0){console.log("failed on rest methods");return}G.ApiClient.iframeRequest(path,
method,params,cb)},iframeRequest:function(path,method,params,cb){var iframe=document.createElement("iframe");iframe.style.display="absolute";iframe.style.top="-10000px";iframe.style.height="0px";iframe.style.width="0px";document.body.appendChild(iframe);var form=document.createElement("form");form.action=this.REST_BASE_URL+path;form.method=method;for(key in params){var input=document.createElement("input");input.type="text";input.name=key;input.value=params[key];form.appendChild(input)}if(cb)iframe.onload=
function(){var content;if(!!iframe.contentWindow.callback)content=iframe.contentWindow.callback();else content=iframe.contentWindow.document.body.innerHTML;cb(content);setTimeout(function(){document.body.removeChild(iframe)},1)};iframe.contentWindow.document.body.appendChild(form);form.submit()}});G.provide("gift",function(method){var methods={create:function(){}};if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof method==="object"||!method)return methods.init.apply(this,
arguments);else $.error("Method "+method+" does not exist on jQuery.tooltip")});G.provide("user",{create:function(params,callback){G.api("/users","post",params,callback)},read:function(params,callback){G.api("/users","get",params,callback)},update:function(params,callback){G.api("/users","put",params,callback)},remove:function(params,callback){G.api("/users","put",params,callback)}});G.provide("pages");G.provide("",{fetch:function(){G.Page.fetch.apply(G.Page,arguments)}});G.provide("Page",{constructors:{},
Base:function(pageName){this.rootNode=document.getElementById(pageName);this._html=this.rootNode.innerHTML;this.hashOnAttribute=function(hash,attr){var elems=this.rootNode.getElementsByTagName("*");for(var i in elems){var elem=elems[i],pid;if(!!elem.getAttribute&&!!(pid=elem.getAttribute(attr)))hash[pid]=elem}},this.preventDefault=function(e){if(!e)return;if(e.preventDefault)e.preventDefault();e.returnValue=false}},create:function(pageName,pageConstructor){if(typeof pageConstructor!="function"){throw"Fatal: G.addPage only takes a constructor function as a argument";
return}console.log(pageName);G.Page.constructors[pageName]=pageConstructor},fetch:function(){var args=Array.prototype.slice.call(arguments),path=args.shift(),container=args.shift(),next=args.shift(),pageName,callback;while(next){var type=typeof next;if(type==="string"&&!pageName)pageName=next;else if(type==="function"&&!callback)callback=next;else{G.log("Invalid argument passed to G.Page.fetch(): "+next);return}next=args.shift()}if(!container.appendChild)throw"Fetch called with invalid container. "+
"Must be able to attachChild on it. Jquery: try $('someSelector')[0]";pageName=pageName||path.replace(/\//g,"_");G.Page.fetchRequest(path,container,pageName,callback)},fetchRequest:function(path,container,pageName,callback){var preamble="<script>window.G = top."+globalName+";<\/script>";G.ApiClient.rest("view_modules/page","get",{path:path,preamble:preamble},function(html){G.pages[pageName]=G.Page.instantiate(pageName,container,html);if(!!callback)callback(G.pages[pageName])})},instantiate:function(pageName,
container,html){var div=document.createElement("div");div.innerHTML=html;for(var i=0;i<div.childNodes.length;++i)container.appendChild(div.childNodes[i]);var pageDiv=document.getElementById(pageName);if(!pageDiv){throw"No page wrapper for page:"+pageName+" all pages must be wrapped"+"in a div with id equal to the page's name";return undefined}var instance;(function(realG){var G={},fn,pids={},base;G["api"]=realG.api;G["user"]=realG.user;eval("fn = "+realG.Page.constructors[pageName].toString());base=
new realG.Page.Base(pageName);fn.prototype=base;base.hashOnAttribute(pids,"pid");instance=new fn})(G);return instance}});G.provide("Array",{indexOf:function(array,item){if(array.indexOf)return array.indexOf(item);var length=array.length;if(length)for(var index=0;index<length;index++)if(array[index]===item)return index;return-1}});G.provide("log",function(){})})(window);
